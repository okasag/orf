load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
dataset$y <- as.numeric(dataset$y)
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model
orf_model$trainForests
View(X)
class(X)
class(X[,1])
class(X[,2])
class(X[,3])
class(X[,4])
class(X[,5])
orf_model$forestInfo$trainData
class(orf_model$forestInfo$trainData)
maindata <- (orf_model$forestInfo$trainData)
forest <- orf_model
eval <- "mean"
newdata <- NULL
### decide if prediction or in sample marginal effects should be evaluated
if (is.null(newdata)) {
# if no newdata supplied, estimate in sample marginal effects
if (forest$forestInfo$inputs$honesty == FALSE) {
data <- forest$forestInfo$trainData # take in-sample data
} else if (forest$forestInfo$inputs$honesty == TRUE) {
data <- forest$forestInfo$honestData
}
} else {
# check if newdata is compatible with train data
if (ncol(newdata) != ncol(forest$forestInfo$trainData)) {
stop("newdata is not compatible with training data. Programme terminated.")
} else {
data = newdata
}
}
### data preparation and checks
# get number of observations
n_data <- as.numeric(nrow(data))
data
class(data)
# get categories
categories <- forest$forestInfo$categories
# get X as matrix
X <- as.matrix(data[, -1])
# get Y as matrix
Y <- as.matrix(data[, 1])
# create indicator variables (outcomes)
Y_ind <- lapply(categories[1:length(categories)-1], function(x) ifelse((Y <= x), 1, 0))
# create datasets with indicator outcomes
data_ind <- lapply(Y_ind, function(x) as.data.frame(cbind(as.matrix(unlist(x)), X)))
data_ind
data_ind[[1]]
data_ind[[1]][[1]]
### marginal effects preparation
# share of SD to be used
h_std <- 0.1
# check if X is continuous or dummy or categorical
X_type <- apply(X, 2, function(x) length(unique(x)))
# now determine the type of X
X_continuous <- which(X_type > 10) # define IDs of continuous Xs
X_dummy <- which(X_type == 2) # define IDs of dummies
X_categorical <- which(X_type > 2 & X_type <= 10)
# additional check for constant variables which are nonsensical
if (any(X_type == 1) | any(X_type == 0)) {
stop("Some of the covariates are constant. This makes no sense for evaluation of marginal effects. Programme terminated.")
}
### check the evaluation point
if (eval == "atmean") {
# variable of interest: X_1 to X_last, ME at mean
X_mean <- lapply(1:ncol(X), function(x) t(as.matrix(colMeans(X)))) # set all Xs to their mean values (so many times as we have Xs)
} else if (eval == "atmedian") {
# variable of interest: X_1 to X_last, ME at median
X_mean <- lapply(1:ncol(X), function(x) t(as.matrix(apply(X, 2, median)))) # set all Xs to their median values (so many times as we have Xs)
} else if (eval == "mean") {
# # variable of interest: X_1 to X_last, mean ME
X_mean <- lapply(1:ncol(X), function(x) X) # set all Xs to their exact values (so many times as we have Xs)
} else {
stop("Incorrect evaluation point. This must be one of be one of mean, atmean, or atmedian. Programme terminated.")
}
### get data needed for evaluation of ME
# get number of evaluation points
X_rows <- nrow(X_mean[[1]])
# get number of Xs
X_cols <- ncol(X_mean[[1]])
# get SD of Xs
X_sd <- rep_row(apply(X, 2, sd), n = X_rows)
# create X_up (X_mean + 0.1 * X_sd)
X_up <- X_mean[[1]] + h_std*X_sd
# # variable of interest: X_1 to X_last, mean ME
X_mean <- lapply(1:ncol(X), function(x) X) # set all Xs to their exact values (so many times as we have Xs)
X_mean
### get data needed for evaluation of ME
# get number of evaluation points
X_rows <- nrow(X_mean[[1]])
# get number of Xs
X_cols <- ncol(X_mean[[1]])
# get SD of Xs
X_sd <- rep_row(apply(X, 2, sd), n = X_rows)
X_sd
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# convert outcome
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
#X <- as.data.frame(dataset[, 1:ncol(dataset)-1])
#Y <- as.matrix(dataset[, ncol(dataset)])
colnames(Y) <- "outcome"
data <- as.data.frame(cbind(Y,X))
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate grf
# with character matrix
forest_grf <- regression_forest(X,Y, mtry = mtry, honesty = TRUE, num.trees = ntree)
orf?
)
?orf
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# convert outcome
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# load orf
library(orf)
# estimate with polr
library(MASS)
library(erer)
### 1. WINE DATA
load("~/Documents/HSG/ORF/data/winequality_dataset_rdata.Rdata")
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model$forestInfo$inputs$inference <- TRUE
orf_mean_me <- margins(orf_model, eval = "mean", NULL)
orf_mean_me
orf_model$forestInfo$inputs$inference <- FALSE
orf_mean_me <- margins(orf_model, eval = "mean", NULL)
orf_mean_me
devtools::document()
devtools::check()
library(orf)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model$forestInfo$inputs$inference <- TRUE
orf_mean_me <- margins(orf_model, eval = "mean", NULL)
orf_mean_me
orf_model$forestInfo$inputs$inference <- FALSE
orf_mean_me <- margins(orf_model, eval = "mean", NULL)
orf_mean_me
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
## save colnames
# Y - numeric response as only regression is supported (so far)
Y <- as.matrix(as.numeric(Y)) # make sure you can add colname
View(Y)
Y <- as.matrix(dataset[, ncol(dataset)])
Y
class(Y)
unclass(Y)
typeof(Y)
as.factor(Y)
class(Y)
unclass(Y)
(Y)
inherits(Y)
inherits(Y,  "matrix")
inherits(X, "matrix")
is.numeric(X)
!is.numeric(X)
inherits(X, "dgCMatrix")
!(inherits(X, "dgCMatrix"))
inherits(X, "Matrix")
inherits(X, "matrix")
inherits(X, "dgCMatrix")
(inherits(X, "dgCMatrix")
)
is.na(X)
any(is.na(X))
inherits(Y, "matrix")
!is.numeric(Y)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
Y_num <- as.numeric(dataset[, ncol(dataset)])
class(Y)
class(Y_num)
inherits(Y, "numeric")
inherits(Y, "matrix")
inherits(Y, "numeric")
(inherits(Y, "matrix") | inherits(Y, "numeric")
)
(inherits(Y, "matrix") | inherits(Y, "numeric"))
is.numeric(Y)
!is.numeric(Y)
( (inherits(Y, "matrix") | inherits(Y, "numeric")) & !is.numeric(Y))
!is.numeric(Y)
length(Y)
length(Y_num)
nrow(Y_num)
nrow(Y)
(length(Y) != nrow(X))
is.null(mtry)
mtry <- 0
is.null(mtry)
is.null(mtry)
ncol(X)
ceiling(sqrt(num.col) + 20)
num.col = ncol(X)
ceiling(sqrt(num.col) + 20)
sqrt(ncol(X))
ceiling(sqrt(ncol(X)))
is.numeric(mtry)
!is.numeric(mtry)
mtry <= 0
(!is.numeric(mtry) | mtry <= 0)
typeof(honesty)
honesty <- TRUE
typeof(honesty)
(!(is.logical(honesty)))
inherits(Y, "numeric")
!is.numeric(Y)
(inherits(Y, "numeric") & !is.numeric(Y))
(inherits(Y_num, "numeric") & !is.numeric(Y))
(inherits(Y, "numeric") & is.numeric(Y))
(inherits(Y_num, "numeric") & !is.numeric(Y_num))
(inherits(Y_num, "numeric") & is.numeric(Y_num))
devtools::document()
devtools::check()
devtools::document()
devtools::check()
library(orf)
devtools::document()
devtools::check()
library(orf)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model
summary(orf_model)
devtools::document()
devtools::check()
library(orf)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
summary(orf_model)
summary(orf_model, latex = 1)
summary(orf_model, latex = 9)
summary(orf_model, latex = TRUE)
devtools::document()
devtools::check()
library(orf)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model$forestInfo$inputs$inference <- TRUE
orf_model
summary(orf_model)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- (dataset[, ncol(dataset)]
)
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model
summary(orf_model)
# load orf
library(orf)
# estimate with polr
library(MASS)
library(erer)
### 2. MAMMOGRAPHY DATA
load("~/Documents/HSG/ORF/data/mammography_dataset_rdata.Rdata")
# prepare data
dataset$SYMPT <- as.numeric(dataset$SYMPT)
dataset$PB <- as.numeric(dataset$PB)
dataset$HIST <- as.numeric(dataset$HIST)
dataset$BSE <- as.numeric(dataset$BSE)
dataset$DECT <- as.numeric(dataset$DECT)
dataset$y <- as.numeric(dataset$y)
# matrices
X <- as.matrix(dataset[, 1:ncol(dataset)-1])
Y <- as.matrix(dataset[, ncol(dataset)])
# prepare parameters
ntree <- 1000
mtry <- ceiling(sqrt(ncol(X)))
nmin <- 5
honesty <- TRUE
inference <- FALSE
margins <- FALSE
# estimate orf in first place
set.seed(311992) # put your birthday here
orf_model <- orf(X,Y,ntree,mtry,nmin,honesty,inference,margins)
orf_model
orf_model$honestMSE
orf_model$honestPredictions
summary(orf_model, latex = TRUE)
summary(orf_model, latex = FALSE)
plot(orf_model)
1.200322/0.533666
0.09/0.1
0.08/0.09
sqrt(200)
sqrt(800)
sqrt(3200)
14*0.2
28/0.2
28*0.2
14*0.4
14*0.1
28*0.05
56*0.05
56*0.025
28*0.09
56*0.08
sqrt(0.1)
sqrt(0.09)
sqrt(0.08)
sqrt(0.1)
sqrt(0.1)/2
sqrt(0.1)/4
