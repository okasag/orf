---
title: "orf: ordered random forests"
author: "Gabriel Okasa"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{orf: ordered random forests}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## orf: Description

R package `orf` is an implementation of the Ordered Forest estimator
as in Lechner & Okasa (2019). The Ordered Forest flexibly
estimates the conditional probabilities of models with ordered
categorical outcomes (so-called ordered choice models).
Additionally to common machine learning algorithms the orf
package provides functions for estimating marginal effects as well
as statistical inference thereof and thus provides similar output
as in standard econometric models for ordered choice. The core
forest algorithm relies on the fast C++ forest implementation
from the ranger package.

## orf: The Algorithm

The main function of the package is `orf` which implements the Ordered Forest
estimator as developed by Lechner & Okasa (2019). The main idea is to
provide a flexible alternative to standard econometric ordered choice
models (categorical dependent variable *with* inherent ordering) such as ordered
logit or ordered probit while still being able to recover
essentially the same output as in the standard parametric models. As such the 
Ordered Forest estimator not only provides estimates of conditional
ordered choice probabilities, i.e. $P[Y=m|X=x]$ but also estimates of marginal
effects, i.e. how the conditional probabilities vary with changes in $X$. Further,
the **orf** estimator provides also inference for the marginal effects as well
as for the conditional probabilities.

More formally, consider an categorical ordered outcome variable $Y_i \in \{1,...,M \}$.
Then, the can be described as follows:

******  
**Algorithm**: Ordered Forest

******
* **begin** Ordered Forest  
    + **do** Cumulative Probabilities  
        - **for** $m=0,...,M$:  
            - **create** binary indicator variables according to: $Y_{m,i}=\mathbf{1}(Y_i \leq m)$  
            - **estimate** regression random forest for: $Y_{m,i}=P[Y_{m,i}=1 \mid X_i=x]$  
            - **predict** conditional probabilities as: $\hat{Y}_{m,i}=\hat{P}[Y_{m,i}=1 \mid X_i=x] = \sum^N_{i=1}\hat{w}_{m,i}(x)Y_{m,i}$  
        - **endfor**  
    + **endo**  
    + **do** Class Probabilities
        - **for** $m=1,...,M$:  
            - **compute** probabilities for each class as follows: $\hat{P}_{m,i}=\hat{Y}_{m,i}-\hat{Y}_{m-1,i}$  
            - **if** $\hat{P}_{m,i}<0$  
                - **set** $\hat{P}_{m,i}=0$ and $\hat{P}_{m,i}=\frac{\hat{P}_{m,i}}{\sum^{M}_{m=1}\hat{P}_{m,i}}$  
            - **endif**  
        - **endfor**  
    + **endo**  
* **end** Ordered Forest


******

## orf: User Functions

For all the above estimators standard `R` functions such as `summary`, `predict`,
or `plot` are provided as well to facilitate the classical `R` user experience.



